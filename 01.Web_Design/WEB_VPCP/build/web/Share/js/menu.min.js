function convertStrVnFormToDate(strVnForm){if(null!=strVnForm)try{var strTemp=new Date(parseInt(strVnForm.substring(6,10)),parseInt(strVnForm.substring(3,5))-1,parseInt(strVnForm.substring(0,2)),0,0,0,0);return eval(strTemp)}catch(ex){}return null}function getFirstTimeOfDate(e){try{return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}catch(t){}return null}function onBlurDBx(e){var t=convertStrVnFormToDate(document.getElementById(e.uuid+"-real").value);e.setValue(t);var n=getFirstTimeOfDate(new Date);n.addDays(1),e._constraint.indexOf("no future")>-1&&t.getTime()>n.getTime()||e.fireOnChange()}function scrollToDiv(e){var t=$("div"),n=$("#"+e);t.scrollTop(n.offset().top-t.offset().top+t.scrollTop())}function getMenuHistory(){var e=page.token.lstMenuHistory;return e.length>1?e[e.length-2]:1==e.length?e[0]:null}function getMenuHistoryId(){var e=page.token.lstMenuHistoryId;return e.length>1?e[e.length-2]:1==e.length?e[0]:null}function getMenuHistoryTabId(){var e=page.token.lstMenuHistoryTabId;return e.length>1?e[e.length-2]:1==e.length?e[0]:null}function gotoMenuHistory(e,t,n){prepareDisplaySelectTab(n,"quang"),highlightSelectedMenu(e);var a=zk.Widget.$("mainContent");data={url:t},page.token.lstMenuHistory.length>1?(page.token.lstMenuHistory.pop(page.token.lstMenuHistory.length-2),page.token.lstMenuHistoryId.pop(page.token.lstMenuHistoryId.length-2),page.token.lstMenuHistoryTabId.pop(page.token.lstMenuHistoryTabId.length-2)):1==page.token.lstMenuHistory.length&&(page.token.lstMenuHistory.pop(0),page.token.lstMenuHistoryId.pop(0),page.token.lstMenuHistoryTabId.pop(0)),zAu.send(new zk.Event(a,"onLoadPage",t))}var menu=new Object;$(document).ready(function(){$(document).on("keydown",handleKeyDown)}),handleKeyDown=function(e){116==(e.which||e.keyCode)&&sendCountRequest()},getImageURLOfFunction=function(e){var t="Share/img/menu/file_list_to_do.png";switch(e){case"/Pages/admin/application/app.zul":t="Share/img/menu/application.png";break;case"/Pages/admin/user/userMan.zul":t="Share/img/menu/userManager.png";break;case"/Pages/admin/role/roleManage.zul":t="Share/img/menu/roleManager.png";break;case"/Pages/admin/department/dept.zul":t="Share/img/menu/deptManager.png";break;case"/Pages/admin/flow/flowManager.zul":t="Share/img/menu/flowManager.png";break;case"/Pages/admin/outsideOffice/index.zul":t="Share/img/menu/outsideOffice.png";break;case"/Pages/admin/category/catManage.zul":t="Share/img/menu/categoryManager.png";break;case"/Pages/document/template/templateMan.zul":t="Share/img/menu/templateManager.png";break;case"/Pages/document/docIn/docInAll.zul?menuType=0":break;case"/Pages/document/docIn/docInList.zul?menuType=1&roleType=2":case"/Pages/document/docIn/docInList.zul?menuType=1":t="Share/img/menu/waitingDoc.png";break;case"/Pages/document/docIn/docInList.zul?menuType=2":t="Share/img/menu/processingDoc.png";break;case"/Pages/document/docIn/docInList.zul?menuType=3":t="Share/img/menu/processedDoc.png";break;case"/Pages/document/docIn/docInList.zul?menuType=5":t="Share/img/menu/retrieveDoc.png";break;case"/Pages/document/docIn/docInList.zul?menuType=4":t="Share/img/menu/receiveToKnow.png";break;case"/Pages/document/docIn/docInList.zul?menuType=7":t="Share/img/menu/waitingOpinion.png";break;case"/Pages/document/docIn/docInList.zul?menuType=8":t="Share/img/menu/gaveOpinion.png";break;case"/Pages/document/docIn/reportBook.zul":t="Share/img/menu/report.png";break;case"/Pages/document/docOut/docDraftMan.zul":t="Share/img/menu/draftDoc.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=1":t="Share/img/menu/waitingDoc.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=3":t="Share/img/menu/processedDoc.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=12":t="Share/img/menu/processedDoc.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=5":t="Share/img/menu/retrieveDoc.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=7":t="Share/img/menu/receiveToKnow.png";break;case"/Pages/document/docOut/docDraftMan.zul?menuType=8":t="Share/img/menu/gaveOpinion.png"}return t},highlightSelectedMenu=function(e){try{var t,n=localStorage.menuId;null!=n&&(t=document.getElementById("img"+n),null!=t&&"none"!=t.style.display&&t.setAttribute("class","")),localStorage.menuId=e;var a=document.getElementById("img"+e);a.setAttribute("class","selected")}catch(o){console.log(o)}},unhighlightSelectedMenu=function(){try{var e=localStorage.menuId;null!=e&&(menuComponent=document.getElementById("img"+e),null!=menuComponent&&"none"!=menuComponent.style.display&&menuComponent.setAttribute("class",""),localStorage.menuId=null)}catch(t){console.log(t)}},getMenuByUrl=function(e,t){var n,a,o,r,u=page.token.lstMenu;if(null!=u&&u.length>0)for(n=0;n<u.length;n++)if(o=u[n],null!=o.lstMenu&&o.lstMenu)for(a=0;a<o.lstMenu.length;a++){if(r=o.lstMenu[a],t&&r.menuUrl===e)return r;if(!t&&r.menuUrl.indexOf(e)>-1)return r}},gotoMenuByUrl=function(e){var t=getMenuByUrl(e);null!=t&&gotoMenu(t.menuId,t.menuUrl)},focusMenuByUrl=function(e){var t=getMenuByUrl(e);null!=t&&highlightSelectedMenu(t.menuId)},gotoMenuUrl=function(e){var t=getMenuByUrl(e);null!=t&&gotoMenu(t.menuId,t.menuUrl)},gotoMenu=function(e,t){highlightSelectedMenu(e);var n=zk.Widget.$("mainContent");data={url:t},page.token.lstMenuHistory.push(t),page.token.lstMenuHistoryId.push(e);var a=$("#menuUL li.selected").attr("name");page.token.lstMenuHistoryTabId.push(a.substring(2)),zAu.send(new zk.Event(n,"onLoadPage",t))},prepareDisplaySelectTab=function(e,t){try{var n=localStorage.lastTabOrder;if(null!=n&&n!=e){var a=document.getElementsByName("li"+n);a[0].setAttribute("class","");var o=document.getElementsByName("group"+n),r=0;for(r=0;r<o.length;r++)o[r].setAttribute("style","display:none")}}catch(u){console.log("when selectab have error : "+u)}var l=document.getElementsByName("group"+e);(null==l||0==l.length)&&(e="0",l=document.getElementsByName("group"+e));var r=0;for(r=0;r<l.length;r++)l[r].setAttribute("style","display:''");var i=document.getElementsByName("li"+e);i[0].setAttribute("class","selected"),localStorage.lastTabOrder=e,localStorage.lastTabName=t},selectTab=function(e,t,n,a){prepareDisplaySelectTab(e,t),null!=n&&gotoMenu(n,a)},sendCountRequest=function(e){var t;null==e&&(e=localStorage.lastTabName);var n=/\/.*?\//,a=n.exec(window.location.pathname);if(0!=a.length){var o=a[0];switch(e){case"Văn bản đến":t=window.location.origin+o+"countMenu?objectType=1";break;case"Văn bản đi":t=window.location.origin+o+"countMenu?objectType=2";break;case"Phiếu trình":t=window.location.origin+o+"countMenu?objectType=7";break;case"Hồ sơ công việc":t=window.location.origin+o+"countMenu?objectType=30";break;default:t=null}null!=e&&null!=t&&$.ajax({url:t,type:"GET",success:function(e){displayMenuCountValue(e)},error:function(e,t,n){}})}},displayMenuCountValue=function(e,t){if(null!=e){for(var n,a=0;a<e.length;a++)n=document.getElementById("span"+e[a].menuId),null!=n&&("0"==e[a].count?n.innerHTML="":n.innerHTML=e[a].count);switch(t){case 1:setNumberOfDocInHome(e);break;case 2:setNumberOfDocOutHome(e)}}},setNumberOfDocOutHome=function(e){for(var t=0;t<e.length;t++)switch(e[t].menuType){case 1:var n=document.getElementById("lbDocOutNotProcess");null!=n&&(n.innerHTML=e[t].count);break;case 6:var a=document.getElementById("lbDocOutPublish");null!=a&&(a.innerHTML=e[t].count);break;case 12:var a=document.getElementById("lbDocOutPublish");null!=a&&(a.innerHTML=e[t].count);break;case 14:var o=document.getElementById("lbDocOutInWeek");if(null!=o){var r=o.parentElement;r.style.display="",o.innerHTML=e[t].count}}},setNumberOfDocInHome=function(e){for(var t=0;t<e.length;t++)switch(e[t].menuType){case 1:var n=document.getElementById("waitingProcessDocIn");null!=n&&(n.innerHTML=e[t].count);break;case 2:var a=document.getElementById("processingDocIn");null!=a&&(a.innerHTML=e[t].count)}},setNumberOfFilesInHome=function(e){for(var t=0;t<e.length;t++)switch(e[t].menuType){case 1:var n=$("#spanNumberOfFileNew");null!=n&&n.html(e[t].count);break;case 2:var a=$("#spanNumberOfFileProcessing");null!=a&&a.html(e[t].count);break;case 3:var o=$("#spanNumberOfFileProcessed");null!=o&&o.html(e[t].count)}},setNumberOfDocSubmitInHome=function(e){for(var t=0;t<e.length;t++)switch(e[t].menuType){case 1:var n=$("#spanNumberOfDocSubmitNew");null!=n&&n.html(e[t].count);break;case 3:var a=$("#spanNumberOfDocSubmitProcessed");null!=a&&a.html(e[t].count)}},menu.drawOfficeMenu=function(e,t,n){var a=document.getElementById(e),o=document.getElementById(t),r=0,u=0,l=n.lstMenu[0].menuId,i=n.lstMenu[0].menuName,c=n.lstMenu[0].menuUrl;for(r=0;r<n.lstMenu.length;r++)try{var s=n.lstMenu[r];if(!s)continue;var m=document.createElement("li");m.innerHTML=s.menuName,m.setAttribute("name","li"+r);var d="",g=null;a.appendChild(m);var p=0;for(p=0;p<s.lstMenu.length;p++){var b=s.lstMenu[p],h=document.createElement("div");if(h.setAttribute("class","group"),h.setAttribute("name","group"+r),h.setAttribute("id","menu"+b.menuId),h.setAttribute("style","display:none"),null==b.lstMenu||b.lstMenu.length<=1){var y=getImageURLOfFunction(b.menuUrl),f=document.createElement("img");f.setAttribute("id","img"+b.menuId),f.setAttribute("src",y),h.appendChild(f),h.setAttribute("onclick","gotoMenu("+b.menuId+",'"+b.menuUrl+"');"),""===d&&(d=b.menuUrl,g=b.menuId)}else{var v=0;for(v=0;v<b.lstMenu.length;v++){var M=document.createElement("div");M.setAttribute("class","item");var y=getImageURLOfFunction(b.lstMenu[v].menuUrl),f=document.createElement("img");f.setAttribute("src",y),f.setAttribute("id","img"+b.menuId),M.appendChild(f);var T=document.createElement("br");M.appendChild(T);var I=document.createElement("div");I.innerHTML=b.lstMenu[v].menuName,M.appendChild(I),M.setAttribute("onclick","gotoMenu("+b.menuId+",'"+b.menuUrl+"');"),h.appendChild(M),""===d&&(d=b.menuUrl,g=b.menuId)}}var k=document.createElement("div");null!=b.lstMenu&&b.lstMenu.length>1?k.setAttribute("class","title"):k.setAttribute("class","function");var w=document.createElement("span");w.setAttribute("id","span"+b.menuId),h.appendChild(w);var D=b.menuName;k.innerHTML=D,h.appendChild(k),o.appendChild(h)}m.setAttribute("onclick","selectTab("+r+",'"+s.menuName+"',"+g+",'"+d+"')"),u+=1}catch(S){}var H=localStorage.lastTabOrder,A=localStorage.lastTabName;null!=s?selectTab(H,A):selectTab("0",i,l,c)},createNotifys=function(){var e="en"==gvLocateVaule,t=page.lstNotify,n=document.getElementById("homeContentDiv");if("undefined"==typeof t||null===t||0===t.length){var a=document.createElement("div");return a.innerHTML="Không có thông báo nào",e&&(a.innerHTML="No notification"),a.setAttribute("style","border:1px solid gray; background-color: rgb(167, 190, 196); margin-bottom:5px; text-align:center; padding:10px; height:50px;color:white"),n.appendChild(a),void(document.getElementById("btnNext").style.display="none")}document.getElementById("btnNext").style.display="";for(var o=0;o<t.length;o++){var r=t[o],a=document.createElement("div"),u=document.createElement("div");u.setAttribute("class","signOfNotifyItem");var l="rgb(167, 190, 196)";1===r.objectType||300===r.objectType?l="rgb(115, 195, 126)":2===r.objectType||600===r.objectType?l="rgb(116, 116, 116)":30===r.objectType?l="rgb(230, 142, 138)":9===r.objectType?l="rgb(83, 143, 215)":20===r.objectType&&(l="#ff8f3f"),20!==r.objectType?(u.setAttribute("style","background-color:"+l),a.appendChild(u)):(u.setAttribute("style","background-color:"+l),a.appendChild(u)),a.setAttribute("class","notifyItem");var i=document.createElement("img");20!==r.objectType?(i.setAttribute("src","Share/avatar/"+r.sendUserId),i.setAttribute("onError","this.onerror=null;this.src='Share/img/default-avatar.png';")):i.setAttribute("src","Share/img/default-avatar.png"),i.setAttribute("width","60px"),i.setAttribute("height","60px"),i.setAttribute("style","float:left;"),a.appendChild(i);var c=document.createElement("div"),s=Date.parse(r.sendTime),m=new Date(s),d=m.getHours()+"h"+m.getMinutes()+" ngày "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear(),g=" gửi cho bạn vào lúc ";e&&(g=" send to you at ",d=m.getHours()+"h"+m.getMinutes()+" - "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear());var p=r.sendUserName+g+d;c.setAttribute("class","titleItems"),c.innerHTML=escapeHtml_(p);var b=document.createElement("div");b.setAttribute("class","contentItems");var h;if(20!==r.objectType)h=escapeHtml_(r.content),h=h.replace(/\n/g,"<br/>");else if(h=(e?"Notify: ":"Thông báo: ")+r.title+"<br/>",null!==r.endTime&&void 0!==r.endTime){var s=Date.parse(r.endTime),m=new Date(s);h=h+(e?"Expired date:":"Hạn thông báo: ")+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()}b.innerHTML=h,a.appendChild(c),a.appendChild(b),20!==r.objectType?(a.setAttribute("onclick","viewNotify("+r.documentId+","+r.objectType+","+r.sendUserId+","+r.notifyId+',"'+r.receiver+'");'),n.appendChild(a)):(a.setAttribute("onclick","viewNotifyAlert("+r.notifyId+","+r.objectType+");"),n.appendChild(a))}viewNotify=function(e,t,n,a,o){var r={documentId:e,objectType:t,sendUserId:n,notifyId:a,receiver:"undefined"==o?"":o},u=zk.Widget.$("$homeWnd");zAu.send(new zk.Event(u,"onOpenView",{"":r}))},viewNotifyAlert=function(e,t){var n={notifyId:e,objectType:t},a=zk.Widget.$("$homeWnd");zAu.send(new zk.Event(a,"onOpenViewAlert",{"":n}))}};