var calendar=null;Date.prototype.addDays=function(e){var t=this.getTime()+24*e*60*60*1e3,a=new Date(t);return a},viewCalendar=function(e){var t=zk.Widget.$("$"+calendar.calendarView.component);zAu.send(new zk.Event(t,"onView",e))},createNewCalendar=function(e,t,a){e-=1,0>e&&(e=6);var n=calendar.calendarView.date.addDays(e);n.setHours(t),n.setMinutes(a);var r=zk.Widget.$("$"+calendar.calendarView.component);zAu.send(new zk.Event(r,"onCreateCalendar",n.getTime()))},createNewCalendarForMonth=function(e,t,a){var n=new Date;n.setYear(a),n.setMonth(t),n.setDate(e),n.setHours(8),n.setMinutes(0);var r=zk.Widget.$("$"+calendar.calendarView.component);zAu.send(new zk.Event(r,"onCreateCalendar",n.getTime()))},getString=function(e){var t="";return e.constructor==String?t=e:e.constructor==Array&&(t=e.join("")),sd.validator.trim(t)},convertStringToTime=function(e){try{var t=new Date(e);return t}catch(a){return void 0}},convertStringToTimeFormat=function(e){try{var t=new Date(e),a=t.getHours()>=10?t.getHours():"0"+t.getHours(),n=t.getMinutes()>=10?t.getMinutes():"0"+t.getMinutes(),r=a+":"+n;return r}catch(l){return""}},convertStringToDateFormat=function(e){try{var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();n=n>=10?n:"0"+n,r=r>=10?r:"0"+r;var l=r+"/"+n+"/"+a;return l}catch(i){return""}},escapeHtml_=function(e){var t="";return null!=e&&""!=e&&(t=e.toString().replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&39;"),t=t.replace(/"/g,"&quot;")),t},onMouseWheel=function(){var e=window.event||e,t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(!(t>0)){var a=document.documentElement.scrollTop||document.body.scrollTop,n=document.body.scrollHeight-document.body.clientHeight;return a>=n?(calendar.calendarView.start=7,calendar.nextWeek(),calendar.generateWeekCalendar(),document.body.scrollTop=0,document.documentElement.scrollTop=0,!1):!0}var a=document.documentElement.scrollTop||document.body.scrollTop;return 0!=a?!0:calendar.calendarView.start>0?(calendar.calendarView.start--,calendar.generateWeekCalendar(),calendar.rendCalendar(),!1):(calendar.calendarView.start=7,calendar.generateWeekCalendar(),calendar.previousWeek(),void 0)},calendarWeek=function(){this.previousWeek=function(){this.calendarView.date=this.calendarView.date.addDays(-7),this.updateInfo(),this.getCalendar()},this.nextWeek=function(){this.calendarView.date=this.calendarView.date.addDays(7),this.updateInfo(),this.getCalendar()},this.updateInfo=function(){var e=this.calendarView.date,t=e.addDays(6);document.getElementById("displayWeek").innerHTML=e.getDate()+"/"+(e.getMonth()+1)+"-"+t.getDate()+"/"+(t.getMonth()+1)+"  Năm "+t.getFullYear()},this.generateWeekCalendar=function(){var e=0,t=document.getElementById("t7");for(t.innerHTML="",e=this.calendarView.start;24>e;e++){var a="";a=12>=e?e+" am":e-12+" pm";var n=document.createElement("div");n.innerHTML=a,n.setAttribute("class","timeLineDiv"),t.appendChild(n)}var e=1,r=0;for(e=0;6>=e;e++){t=document.getElementById("t"+e),t.innerHTML="";var n=document.createElement("div");for(n.setAttribute("style","display:block;position:relative"),n.setAttribute("id","div"+e),t.appendChild(n),r=this.calendarView.start;24>r;r++){var l=document.createElement("div");l.setAttribute("class","oddDiv"),l.setAttribute("ondblclick","createNewCalendar("+e+","+r+",0);");var i=document.createElement("div");i.setAttribute("class","evenDiv"),i.setAttribute("ondblclick","createNewCalendar("+e+","+r+",30);"),t.appendChild(l),t.appendChild(i)}}},this.getPosition=function(e){if(null==e)return null;var t=e.getHours(),a=e.getMinutes(),n=42*(t-this.calendarView.start)+a/30*21;return n},this.updateCalendarDisplay=function(e){var t=document.getElementById("cal"+e.calendarId),a=e.top,n=e.height,r=e.width,l=e.left,i="top:"+a+"px;left:"+l+"%;height:"+n+"px;width:"+r+"%";t.setAttribute("style",i)},this.rendCalendar=function(){for(var e=0;e<this.lstDateCalendar.length;e++){var t=convertStringToTime(this.lstDateCalendar[e].date),a=document.getElementById("div"+t.getDay()),n=a.clientWidth;a.innerHTML="";var r=document.getElementById("t0"+t.getDay());if(r.innerHTML="",null==this.lstDateCalendar[e].lstCalendar||0==this.lstDateCalendar[e].lstCalendar.length);else for(var l=0;l<this.lstDateCalendar[e].lstCalendar.length;l++){var i=document.createElement("div"),d=convertStringToTime(this.lstDateCalendar[e].lstCalendar[l].timeStart),s=convertStringToTime(this.lstDateCalendar[e].lstCalendar[l].timeEnd),o=this.getPosition(d),c=1,h=this.getPosition(s),u=document.createElement("div");s.getDate()!=d.getDate()||s.getMonth()!=d.getMonth()||s.getYear()!=d.getYear()?(o=-1,h=0,u.innerHTML=convertStringToDateFormat(this.lstDateCalendar[e].lstCalendar[l].timeStart)+"-"+convertStringToDateFormat(this.lstDateCalendar[e].lstCalendar[l].timeEnd)):u.innerHTML=convertStringToTimeFormat(this.lstDateCalendar[e].lstCalendar[l].timeStart)+"-"+convertStringToTimeFormat(this.lstDateCalendar[e].lstCalendar[l].timeEnd),i.appendChild(u);var m=0,g=95;0>o&&h>0&&(o=0),m=null==h?41:h-o,0>=m&&(m=3);for(var C=l-1;C>=0;C--)this.lstDateCalendar[e].lstCalendar[C].top<0||this.lstDateCalendar[e].lstCalendar[C].bottom>=o&&(c+=5,c>n-10&&(c=n-5),g-=5);0>g&&(g=0),this.lstDateCalendar[e].lstCalendar[l].left=c,this.lstDateCalendar[e].lstCalendar[l].top=o,this.lstDateCalendar[e].lstCalendar[l].bottom=h,this.lstDateCalendar[e].lstCalendar[l].height=m,this.lstDateCalendar[e].lstCalendar[l].width=g;var v="top:"+o+"px;left:"+c+"%;height:"+m+"px;width:"+g+"%";i.setAttribute("style",v),i.setAttribute("class","divCalendarWeek"),i.setAttribute("id","cal"+this.lstDateCalendar[e].lstCalendar[l].calendarId),i.setAttribute("onclick","viewCalendar("+this.lstDateCalendar[e].lstCalendar[l].calendarId+")");var p=parseInt(this.lstDateCalendar[e].lstCalendar[l].status.toString());2==p?i.setAttribute("class","divCalendarWeekApprove"):p>2?i.setAttribute("class","divCalendarWeekReject"):i.setAttribute("class","divCalendarWeek");var w=document.createElement("div");if(w.innerHTML=escapeHtml_(this.lstDateCalendar[e].lstCalendar[l].title),i.setAttribute("title",escapeHtml_(this.lstDateCalendar[e].lstCalendar[l].title)),i.appendChild(w),0>o){console.log(i.innerHTML),i.setAttribute("style","position:relative;margin:1px"),console.log(i.getAttribute("style"));var D=document.getElementById("t0"+t.getDay());D.appendChild(i)}else a.appendChild(i)}}},this.loadCalendar=function(){this.rendCalendar()},this.initCalendar=function(e){var t=new Date,a=parseInt(t.getDay());if(a>=1){var n=-1*a+1;t=t.addDays(n)}else t=t.addDays(-6);this.calendarView=new Object,this.calendarView.component=e,this.calendarView.date=t,this.calendarView.start=7,this.generateWeekCalendar(),this.updateInfo(),this.getCalendar()},this.getCalendar=function(){var e=this.calendarView.date,t=this.calendarView.date.addDays(6),a=document.getElementById("searchFullText").value,n={fromDate:e.getTime(),toDate:t.getTime(),searchText:a},r=zk.Widget.$("$"+this.calendarView.component);zAu.send(new zk.Event(r,"onSearch",JSON.stringify(n)))},this.initMouseWheel=function(){var e=document.getElementById("weekCalendarDiv");e.addEventListener?(e.addEventListener("mousewheel",onMouseWheel,!1),e.addEventListener("DOMMouseScroll",onMouseWheel,!1)):e.attachEvent("onmousewheel",onMouseWheel)},this.onMouseMove=function(){}},calendarMonth=function(){this.previousMonth=function(){this.calendarView.month=this.calendarView.month-1,this.calendarView.month<0&&(this.calendarView.month=this.calendarView.month+12,this.calendarView.year-=1),this.generateMonthCalendar(this.calendarView.month,this.calendarView.year),this.getCalendar()},this.nextMonth=function(){this.calendarView.month=this.calendarView.month+1,this.calendarView.month>11&&(this.calendarView.month=this.calendarView.month-12,this.calendarView.year+=1),this.generateMonthCalendar(this.calendarView.month,this.calendarView.year),this.getCalendar()},this.generateMonthCalendar=function(e,t){this.calendarView.month=e,this.calendarView.year=t,document.getElementById("displayMonth").innerHTML="Tháng "+(e+1)+" Năm "+t;var a=document.getElementById("calendarMonth").getElementsByTagName("tbody")[0],n=a.getElementsByTagName("tr"),r=0;for(r=n.length-1;r>0;r--)a.removeChild(n[r]);var l=new Date(t,e,1);l.getDay()>1?l=l.addDays(-1*l.getDay()+1):0===l.getDay()&&(l=l.addDays(-6));for(var i=0,d=l;;){var s=document.createElement("tr");s.setAttribute("class","monthHeader");var o=document.createElement("tr");o.setAttribute("class","monthContent");var r=0;for(r=0;7>r;r++){d=l.addDays(7*i+r);var c=document.createElement("td");1==d.getDate()?c.innerHTML=d.getDate()+"/"+(d.getMonth()+1):c.innerHTML=d.getDate();var h=document.createElement("td"),u=d.getDate()+"_"+d.getMonth()+"_"+d.getFullYear();h.setAttribute("id",u),h.setAttribute("ondblclick","createNewCalendarForMonth("+d.getDate()+","+d.getMonth()+","+d.getFullYear()+");"),s.appendChild(c),o.appendChild(h),d.getMonth()!=this.calendarView.month&&h.setAttribute("class","noActive")}if(a.appendChild(s),a.appendChild(o),i++,d.getFullYear()>this.calendarView.year)break;if(d.getMonth()>this.calendarView.month)break}},this.rendCalendar=function(){for(var e=0;e<this.lstDateCalendar.length;e++){var t=convertStringToTime(this.lstDateCalendar[e].date),a=t.getDate()+"_"+t.getMonth()+"_"+t.getFullYear(),n=document.getElementById(a);if(null!=n)if(n.innerHTML="",null==this.lstDateCalendar[e].lstCalendar||0==this.lstDateCalendar[e].lstCalendar.length);else for(var r=0;r<this.lstDateCalendar[e].lstCalendar.length;r++){var l=document.createElement("div");l.innerHTML=escapeHtml_(this.lstDateCalendar[e].lstCalendar[r].title),l.setAttribute("onclick","viewCalendar("+this.lstDateCalendar[e].lstCalendar[r].calendarId+")");var i=parseInt(this.lstDateCalendar[e].lstCalendar[r].status.toString());2==i?l.setAttribute("class","divCalendarMonthApprove"):i>2?l.setAttribute("class","divCalendarMonthReject"):l.setAttribute("class","divCalendarMonth"),n.appendChild(l)}}},this.loadCalendar=function(){this.rendCalendar()},this.getCalendar=function(){var e=new Date(this.calendarView.year,this.calendarView.month,1),t=null;t=11==this.calendarView.month?new Date(this.calendarView.year+1,0,1):new Date(this.calendarView.year,this.calendarView.month+1,1);var a=document.getElementById("searchFullText").value,n={fromDate:e.getTime(),toDate:t.getTime(),searchText:a},r=zk.Widget.$("$"+this.calendarView.component);zAu.send(new zk.Event(r,"onSearch",JSON.stringify(n)))},this.onMouseWheel=function(){if(event.wheelDelta>0){var e=document.documentElement.scrollTop||document.body.scrollTop;if(0!=e)return!0;this.previousMonth(),document.body.scrollTop=0,document.documentElement.scrollTop=0}else{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.body.scrollHeight-document.body.clientHeight;if(!(e>=t))return!0;this.nextMonth(),document.body.scrollTop=0,document.documentElement.scrollTop=0}},this.initCalendar=function(e){var t=new Date;this.calendarView=new Object,this.calendarView.component=e,this.generateMonthCalendar(t.getMonth(),t.getFullYear()),this.getCalendar()}},calendarList=function(){this.previousWeek=function(){this.calendarView.date=this.calendarView.date.addDays(-7),this.updateInfo(),this.getCalendar()},this.nextWeek=function(){this.calendarView.date=this.calendarView.date.addDays(7),this.updateInfo(),this.getCalendar()},this.updateInfo=function(){var e=this.calendarView.date,t=e.addDays(6);document.getElementById("displayWeek").innerHTML=e.getDate()+"/"+(e.getMonth()+1)+"-"+t.getDate()+"/"+(t.getMonth()+1)+"  Năm "+t.getFullYear()},this.clearCalendar=function(){for(var e=document.getElementById("calendarTable"),t=e.getElementsByTagName("tr"),a=t.length-1;a>=1;a--)e.removeChild(t[a])},this.rendCalendar=function(){this.clearCalendar();for(var e=document.getElementById("calendarTable"),t=0;t<this.lstDateCalendar.length;t++){var a=document.createElement("tr"),n=document.createElement("td");if(n.setAttribute("colspan","7"),n.setAttribute("align","center"),n.setAttribute("style","font-weight:bold"),n.setAttribute("class","dayOfCalendar"),n.innerHTML=escapeHtml_(this.lstDateCalendar[t].text),a.appendChild(n),e.appendChild(a),null==this.lstDateCalendar[t].lstCalendar||0==this.lstDateCalendar[t].lstCalendar.length){var r=document.createElement("tr"),l=document.createElement("td");l.innerHTML="Không có lịch trong ngày",l.setAttribute("colspan","7"),l.setAttribute("align","center"),r.appendChild(l),e.appendChild(r)}else for(var i=0;i<this.lstDateCalendar[t].lstCalendar.length;i++){var d=this.lstDateCalendar[t].lstCalendar[i],r=document.createElement("tr"),s=document.createElement("td");s.setAttribute("style","font-weight:bold"),s.setAttribute("align","center"),s.innerHTML=convertStringToTimeFormat(d.timeStart);var o=document.createElement("td");o.setAttribute("style","font-weight:bold; color:#7b2e00;cursor:pointer"),o.setAttribute("onclick","viewCalendar("+d.calendarId+");");var c=document.createElement("div");c.innerHTML=escapeHtml_(d.title),o.appendChild(c);var h=document.createElement("td");h.innerHTML=escapeHtml_(d.locationName);var u=document.createElement("td");u.innerHTML=escapeHtml_(d.manChief);var m=document.createElement("td");m.innerHTML=escapeHtml_(d.manParticipant);var g=document.createElement("td");g.innerHTML=escapeHtml_(d.manPrepare);var C=document.createElement("td"),v="";null==d.status||0==d.status||1==d.status?v="Chờ duyệt":2==d.status?v="Đã duyệt":3==d.status?v="Từ chối":4==d.status&&(v="Đã hủy"),C.innerHTML=v,r.appendChild(s),r.appendChild(o),r.appendChild(h),r.appendChild(u),r.appendChild(m),r.appendChild(g),r.appendChild(C),e.appendChild(r)}}},this.loadCalendar=function(){this.rendCalendar()},this.initCalendar=function(e){var t=new Date,a=parseInt(t.getDay());if(a>=1){var n=-1*a+1;t=t.addDays(n)}else t=t.addDays(-6);this.calendarView=new Object,this.calendarView.component=e,this.calendarView.date=t,this.calendarView.start=7,this.updateInfo(),this.getCalendar()},this.getCalendar=function(){var e=this.calendarView.date,t=this.calendarView.date.addDays(6),a=document.getElementById("searchFullText").value,n={fromDate:e.getTime(),toDate:t.getTime(),searchText:a},r=zk.Widget.$("$"+this.calendarView.component);zAu.send(new zk.Event(r,"onSearch",JSON.stringify(n)))}};