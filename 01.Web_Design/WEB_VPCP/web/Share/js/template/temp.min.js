"use strict";function replaceAll(e,t,i){return i.replace(new RegExp(e,"g"),t)}function tableWrap(e,t){var i=document.getElementById(e);if(null!=i){var a=i.parentNode;if(null!=a&&"td"!==a.nodeName){for(var n=a.childNodes,s="<table id='"+e+"_TableId'><tr>",l=0;l<n.length;l++)s+="<td>",s+="#text"===n[l].nodeName?n[l].nodeValue:n[l].outerHTML,s+="</td>";s+="</tr></table>",a.innerHTML=s;var o=$("#"+e+"_LabelId").width();null!=t&&$("#"+e+"_TableId").css("width","100%"),$("#"+e+"_LabelId").css("width",o)}}}function imageExists(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!=t.status}var voTemp=function(){};voTemp.prototype={docSubmitNumberTextbox:null,specialTypePattern:"((,\\s*)|(^\\s*))specialType((\\s*,)|(\\s*$))",shortDeptNameWidget:null,spanMaskId:"vt_voTemp_",domMaskId:"vt_domTemp_",WIDGET_ID:"voffice_widget_",mySignature:"",listMaskTemp:[],listDomNode:[],listWidget:[],initWidget:function(e){var t=[];if(null!=e)for(var i=0;i<e.length;i++)t.push.apply(t,e[i]);var a,n,s,l=this.listMaskTemp;this.listWidget.length=0;for(var i=0;i<l.length;i++){var o=l[i];tableWrap(this.spanMaskId+o.maskName,o.widthPercent);var r=document.getElementById(this.spanMaskId+o.maskName);if(null!=r){r.innerHTML='<div id="innerDiv_'+o.maskName+'">';var m=document.getElementById("innerDiv_"+o.maskName);n=this.WIDGET_ID+o.maskName,s=this.indexOfWidget(t,n),s>=0?(t.slice(s,1),a=this.createWidgetFromClass(t[s],o)):a=this.createWidgetFromTemplate(o),null!=a?(this.listWidget.push(a),a.replaceHTML(m),a.maskTemp=o,this.prepareCommentOption(a),this.prepareStyleForDom(a._node,o),this.listDomNode.push(a._node),"zul.wgt.Button"===a.className&&("button"===a.maskTemp.dataType?a.domListen_(a._node,"onclick",function(){tempView.isExistedSignature()&&tempView.submitWidgetInfo(signSubmitDoc,this)}):"buttonCA"===a.maskTemp.dataType&&a.domListen_(a._node,"onclick",function(){if(tempView.isExistedSignature()){var e={targetId:this.id};zAu.send(new zk.Event(zk.Widget.$("$wdDocSubmitCrud"),"onClickSignBtn",{"":e}))}}))):console.log("Do not create widget "+o.maskName)}else console.log(" dom element not found : id = "+this.spanMaskId+o.maskName)}this.prepareDataPopupContentCmts()},prepareCommentOption:function(e){var t=e.maskTemp.dataType;if("string"===t||"listString"===t||"date"===t||"docSubmitNumber"===t||"select"===t){var i=e._node,a=this.createPopupCmtPopup(e);i.parentNode.insertBefore(a,i.parentNode.firstChild);var n=this.createPopupCmtOptionView(e);i.parentNode.insertBefore(n,i.parentNode.firstChild);var s=this.createPopupCmtOptionCreate(e);i.parentNode.insertBefore(s,i.parentNode.firstChild);var l=this.createPopupCmtCreate(e);i.parentNode.insertBefore(l,i.parentNode.firstChild),this.preparePopupContentCmts(e),n.onclick=function(){$("#"+a.id).slideToggle("fast")},s.onclick=function(e){$("#"+l.id).slideToggle("fast"),e&&($("#"+l.id)[0].childNodes[1].value="")},a.onmouseover=function(){a.style.opacity=1},a.onmouseout=function(){a.style.opacity=.6},l.onmouseover=function(){l.style.opacity=1},l.onmouseout=function(){l.style.opacity=.6}}},createPopupCmtOptionCreate:function(e){var t=document.createElement("DIV");return t.id="cmtOptionCreate_"+e.id,t.className="tempOptionCommentCreate",t},createPopupCmtOptionView:function(e){var t=document.createElement("DIV");return t.id="cmtOption_"+e.id,t.className="tempOptionComment",t},createPopupCmtCreate:function(e){var t=document.createElement("DIV"),i="divCmtCreate_"+e.id;t.id=i,t.className="tempDivCmtCreate",t.style.top="-130px",t.style.right="-235px",t.style.display="none";var a=document.createElement("TEXTAREA"),n=document.createElement("BUTTON");return n.innerHTML="Lưu",t.innerHTML="<div class='tempDivTitleCmtCreate'>Thêm mới ghi chú<div>",t.appendChild(a),t.appendChild(n),n.onclick=function(){var t={maskTempId:e.maskTemp.maskTempId,content:a.value};zAu.send(new zk.Event(zk.Widget.$("$wdDocSubmitCrud"),"onCommentMaskTemp",{"":t}))},t},callbackSaveBtnOnclick:function(e){this.tempComments.push(e);for(var t=0;t<this.listWidget.length;t++)if(e.maskTempId==this.listWidget[t].maskTemp.maskTempId){var i=document.getElementById("cmtOptionCreate_"+this.listWidget[t].id);i.onclick(!0);break}this.prepareDataPopupContentCmts()},createPopupCmtPopup:function(e){var t=document.createElement("DIV");return t.id="cmtPopup_"+e.id,t.className="tempPopupComment",t.style.top="-25px",t.style.right="-235px",t.style.display="none",t},preparePopupContentCmts:function(e){var t="divCmt_"+e.id,i="divAction_"+e.id,a=document.createElement("DIV"),n=document.createElement("DIV");a.id=t,a.className="tempDivCmt",n.id=i;var s=document.getElementById("cmtPopup_"+e.id);s&&(s.appendChild(a),s.appendChild(n)),a.innerHTML='<div class="tempDivTitleCmt"><a>Ý kiến</a></div><div class="tempDivListCmt" id="tempDivListCmt_'+e.id+'"><div class="tempDivLisCmtEmpty">Chưa có ý kiến nào</div></div>'},prepareDataPopupContentCmts:function(){if(this.tempComments&&this.tempComments.length>0)for(var e=0;e<this.listWidget.length;e++)for(var t=!0,i=0;i<this.tempComments.length;i++)if(this.listWidget[e].maskTemp.maskTempId===this.tempComments[i].maskTempId){var a=document.getElementById("tempDivListCmt_"+this.listWidget[e].id),n='<div class="tempDivLisCmtEntity">'+this.tempComments[i].contents+"</div>";t||"tempDivLisCmtEmpty"===a.firstChild.className?(a.innerHTML=n,t=!1):a.innerHTML+=n}},getTextboxWidget:function(e,t){return new zul.inp.Textbox({id:e,value:t,multiline:!0,rows:1})},getButtonWidget:function(e,t,i){return new zul.wgt.Button({id:e,label:t,visible:i})},getLabelWidget:function(e,t){return new zul.wgt.Label({id:e,value:t})},getListboxWidget:function(e,t){return new zul.sel.Listbox({id:e})},getDateboxWidget:function(e,t){return new zul.db.Datebox({id:e,value:t})},getImageWidget:function(e,t){return new zul.wgt.Image({id:e,src:t,width:"248"})},createWidgetFromTemplate:function(e){null!=zk.Widget.$("$"+this.WIDGET_ID+e.maskName)&&delete zk.Widget.$("$"+this.WIDGET_ID+e.maskName);var t;if(e.isEnable)switch(e.dataType){case"string":case"listString":t=this.getTextboxWidget(this.WIDGET_ID+e.maskName,e.value);break;case"date":t=this.getDateboxWidget(this.WIDGET_ID+e.maskName,e.value);break;case"button":case"buttonCA":t=this.getButtonWidget(this.WIDGET_ID+e.maskName,e.value);break;case"select":t=this.getListboxWidget(this.WIDGET_ID+e.maskName,e.value);break;case"label":t=this.getLabelWidget(this.WIDGET_ID+e.maskName,e.value)}else t="button"!==e.dataType&&"buttonCA"!==e.dataType?this.getLabelWidget(this.WIDGET_ID+e.maskName,e.value):this.getLabelWidget(this.WIDGET_ID+e.maskName,"");return t&&(t.enable=e.isEnable,t.specialType=e.specialType,e.specialType&&(e.isEnable&&this.isWidgetSpecialType("docSubmitNumber",e.specialType)&&(this.docSubmitNumberTextbox=t),e.isEnable&&this.isWidgetSpecialType("shortDeptName",e.specialType)&&(this.shortDeptNameWidget=t))),t},isWidgetSpecialType:function(e,t){var i=new RegExp(this.specialTypePattern.replace("specialType",e)),a=t.match(i);return a?!0:!1},createWidgetFromClass:function(e,t){null!=zk.Widget.$("$"+e.id)&&delete zk.Widget.$("$"+e.id);var i;if(t.isEnable)switch(e.className){case"zul.inp.Textbox":i=this.getTextboxWidget(e.id,e.value);break;case"zul.wgt.Button":var a=e.value;null==a&&(a=t.value),i=this.getButtonWidget(e.id,a,!1);break;case"zul.wgt.Label":i=this.getLabelWidget(e.id,e.value);break;case"zul.sel.Listbox":i=this.getListboxWidget(e.id,e.value);break;case"zul.db.Datebox":i=this.getDateboxWidget(e.id,e.value);break;case"zul.wgt.Image":i=this.getImageWidget(e.id,e.value)}else"zul.wgt.Image"===e.className?i=this.getImageWidget(e.id,e.value):"zul.wgt.Button"!==e.className&&(i=this.getLabelWidget(e.id,e.value));return i&&(i.widgetInfo=e,i.enable=t.isEnable,i.specialType=t.specialType),i},indexOfWidget:function(e,t){for(var i=0;i<e.length;i++)if(e[i].id==t)return i;return-1},getWidgetValue:function(e){var t;if(null!=e)switch(e.className){case"zul.inp.Textbox":case"zul.wgt.Label":case"zul.db.Datebox":t=e._value;break;case"zul.wgt.Button":break;case"zul.sel.Listbox":}return t},validateDocSubmit:function(e,t){null!=this.docSubmitNumberTextbox?e(this.docSubmitNumberTextbox.getValue()):this.submitWidgetInfo(t)},submitWidgetInfo:function(e,t){if(confirm("Bạn có muốn ký?")){var i,a={content:[],logChanges:[]};if(null!=this.listWidget)for(var n=0;n<this.listWidget.length;n++){i=this.listWidget[n];var s={};if("zul.wgt.Button"===i.className&&null!=t&&"zul.wgt.Button"===t.className){if(s.id=i.id,s.className="zul.wgt.Image",null==this.mySignature||""===this.mySignature.toString().trim()||!imageExists("/voffice/Share/signature/"+this.mySignature))return void alert("Thông tin cá nhân thiếu chữ ký!");"button"===i.maskTemp.dataType?s.value="/voffice/Share/signature/"+this.mySignature:"button"===i.maskTemp.dataType&&(s.value="/voffice/Share/signature/"+this.mySignature)}else i.enable&&(s.id=i.id,s.className=i.className,s.value=this.getWidgetValue(this.listWidget[n]));if(a.logChanges.push(s),null!=i.specialType&&i.specialType.search(this.specialTypePattern.search("specialType","content"))){var l=this.getWidgetValue(i);l&&a.content.push(l)}}return null!=e&&"function"==typeof e&&e(a),a}},prepareStyleForWidget:function(e){this.prepareStyleForDom(e._node)},prepareStyleForDom:function(e,t){if(null!=e){for(var i=e.parentNode,a=7,n=0;a>n;){if(null!=i&&"b"===i.nodeName.toLowerCase())e.style.fontWeight="bold";else if(null==i||"p"===i.nodeName.toLowerCase())break;i=i.parentNode,n++}setInheritFontStyle(e),("input"===e.nodeName.toLowerCase()||"textarea"===e.nodeName.toLowerCase())&&(e.style.background="#e1e1e1 none repeat scroll 0 0",e.style.border="none",e.style.resize="none",e.style.marginTop="-2px",e.onfocus=function(){var e=getMaskTempByDom(this);null!=e&&null!=e.value&&onfocusTempTextbox(this,e.value)},e.onblur=function(){var e=getMaskTempByDom(this);null!=e&&null!=e.value&&onblurTempTextbox(this,e.value)}),"textarea"===e.nodeName.toLowerCase()&&autosize(e),null!=t&&(null!=t.widthPercent&&(e.style.width=t.widthPercent+"%",null!=t.maxWidthPercent&&(e.style.maxWidth=Math.round(t.maxWidthPercent*e.parentNode.clientWidth/100)+"px")),null!=t.maxWidthPercent&&(e.style.maxWidth=Math.round(t.maxWidthPercent*i.clientWidth/100)+"px"))}},getMaskTempByName:function(e){var t=null;if(null!=e)for(var i=0;i<this.listMaskTemp.length;i++)if(this.listMaskTemp[i].maskName===e){t=this.listMaskTemp[i];break}return t},showWidgetByNextNode:function(e){if(e)for(var t=0;t<this.listWidget.length;t++)"zul.wgt.Button"===this.listWidget[t].className&&(this.listWidget[t].maskTemp.nextNodeId==e?this.listWidget[t].setVisible(!0):this.listWidget[t].setVisible(!1))},isExistedSignature:function(){return null!=this.mySignature&&""!==this.mySignature.toString().trim()&&imageExists("/voffice/Share/signature/"+this.mySignature)?!0:(alert("Thông tin cá nhân thiếu chữ ký!"),!1)},setBookNumber:function(e,t){console.log("setBookNumber: "+e),null!=this.docSubmitNumberTextbox&&this.docSubmitNumberTextbox.setValue(e)},setShortDeptName:function(e){console.log("setShortDeptName: "+e),null!=this.shortDeptNameWidget&&this.shortDeptNameWidget.setValue(e)}};var getMaskTempByDom=function(e){if(null!=tempView){var t=tempView.listDomNode.indexOf(e);if(t>=0)return tempView.listMaskTemp[t]}return null},getZkWidgetMask=function(e){var t=zk.Widget.$("$maskValue_"+e),i=zk.Widget.$("$maskMaxLength_"+e),a={widgetValue:t,widgetMaxLength:i};return a},onchangeMask=function(e){},onchangeDataTypeMask=function(e){var t=e.getId().replace("$maskDataType_","");onchangeMask(t)},onchangeValueMask=function(e){var t=e.getId().replace("maskValue_","");onchangeMask(t)},onchangeMaxlengthMask=function(e){var t=e.getId().replace("maskMaxLength_","");onchangeMask(t)},setInheritFontStyle=function(e){e.style.fontSize="inherit",e.style.fontWeight="inherit",e.style.fontFamily="inherit"},onfocusTempTextbox=function(e,t){e.value===t&&(e.value="")},onblurTempTextbox=function(e,t){""===e.value.trim()&&(e.value=t)};$.getScript("/voffice/Share/js/template/areaResize.min.js",function(){});